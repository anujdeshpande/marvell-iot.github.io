<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>AWS IoT Starter SDK: wmsdk/src/incl/sdk/push_button.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AWS IoT Starter SDK
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_888e8a7168914c1639e2b782ab576ffb.html">wmsdk</a></li><li class="navelem"><a class="el" href="dir_259f8adb590fc33753e622d97b880658.html">src</a></li><li class="navelem"><a class="el" href="dir_a5320c50c325612ba11f999ef1d74fbb.html">incl</a></li><li class="navelem"><a class="el" href="dir_8d6a29e47fa7a432e99c9e8c3471a4bd.html">sdk</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">push_button.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Push button helper functions.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="generic__io_8h_source.html">generic_io.h</a>&gt;</code><br />
</div>
<p><a href="push__button_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab3f80e0fc754a534b159407dcbf28921"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="push__button_8h.html#ab3f80e0fc754a534b159407dcbf28921">MAX_PB_CB</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:ab3f80e0fc754a534b159407dcbf28921"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7dee5fc82e4d14beb42c8e13bbaa6808"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="push__button_8h.html#a7dee5fc82e4d14beb42c8e13bbaa6808">PB_DEF_DEBOUNCE_TIME</a>&#160;&#160;&#160;100</td></tr>
<tr class="separator:a7dee5fc82e4d14beb42c8e13bbaa6808"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a499681011cf54879a32725fffffdf7fc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="push__button_8h.html#a499681011cf54879a32725fffffdf7fc">push_button_set_cb</a> (<a class="el" href="structinput__gpio__cfg__t.html">input_gpio_cfg_t</a> input, <a class="el" href="mdev__gpio_8h.html#aceff8a2454d2cfeb6b50a77f5048964c">gpio_irq_cb</a> pb_cb, int time, int repeat_time, void *data)</td></tr>
<tr class="separator:a499681011cf54879a32725fffffdf7fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6d31f2051b4f222e3b714c7da3dc09a9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="push__button_8h.html#a6d31f2051b4f222e3b714c7da3dc09a9">push_button_reset_cb</a> (<a class="el" href="structinput__gpio__cfg__t.html">input_gpio_cfg_t</a> input, int time)</td></tr>
<tr class="separator:a6d31f2051b4f222e3b714c7da3dc09a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Push button helper functions. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ab3f80e0fc754a534b159407dcbf28921"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_PB_CB&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum callbacks that can be registered for a given push button </p>

</div>
</div>
<a class="anchor" id="a7dee5fc82e4d14beb42c8e13bbaa6808"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PB_DEF_DEBOUNCE_TIME&#160;&#160;&#160;100</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Default key debounce time in milliseconds </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a6d31f2051b4f222e3b714c7da3dc09a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int push_button_reset_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinput__gpio__cfg__t.html">input_gpio_cfg_t</a>&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reset callback function registered for a push button</p>
<p>This function resets the callbacks registered using <a class="el" href="push__button_8h.html#a499681011cf54879a32725fffffdf7fc">push_button_set_cb()</a>, one at a time.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">input</td><td>The push button configuration as per <a class="el" href="structinput__gpio__cfg__t.html">input_gpio_cfg_t</a>. Should be the same as passed to <a class="el" href="push__button_8h.html#a499681011cf54879a32725fffffdf7fc">push_button_set_cb()</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>The time as specified while registering the callback using <a class="el" href="push__button_8h.html#a499681011cf54879a32725fffffdf7fc">push_button_set_cb()</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>WM_SUCCESS on success </dd>
<dd>
-WM_FAIL on failure. This will occur if the button is already pressed when this function is invoked. This is done to avoid unexpected behavior. </dd></dl>

</div>
</div>
<a class="anchor" id="a499681011cf54879a32725fffffdf7fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int push_button_set_cb </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structinput__gpio__cfg__t.html">input_gpio_cfg_t</a>&#160;</td>
          <td class="paramname"><em>input</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="mdev__gpio_8h.html#aceff8a2454d2cfeb6b50a77f5048964c">gpio_irq_cb</a>&#160;</td>
          <td class="paramname"><em>pb_cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>repeat_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set a callback function for push button operations</p>
<p>This API can be used to register different callbacks for the same push button based on the time for which the button is pressed. Consider following use cases to understand the API.</p>
<ol type="1">
<li>Single short press like a simple on/off toggle switch. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;void button1_cb(int pin, void *data)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;short press action&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;}</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;input_gpio_cfg_t button_1;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;button_1.gpio = GPIO_25;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;button_1.type = GPIO_ACTIVE_LOW;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;push_button_set_cb(button_1, button1_cb, 0, 0, NULL);</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;}</div>
</div><!-- fragment --> Note that the time specified is 0. This is the most common use case.</li>
<li>Press and hold for a specified time and release <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;void button1_5sec_cb(int pin, void *data)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;5 sec press and release action&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;}</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;push_button_set_cb(button_1, button1_5sec_cb, 5000, 0, NULL);</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;}</div>
</div><!-- fragment --> The callback will be invoked if the button is pressed for more than 5 seconds and then released.</li>
<li>Press and hold for a specified time and then invoke a callback repeatedly. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;void button1_10sec_repeat_cb(int pin, void *data)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;{</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&lt;repeat action to invoke&gt;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;}</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;{</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;push_button_set_cb(button_1, button1_10sec_repeat_cb, 10000,</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;       200, NULL);</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;}</div>
</div><!-- fragment --> With this, if a button is pressed and held for more than 10 seconds, after the 10 second timeout, the callback is invoked for every 200 msec until the button is released. Note that if the repeat time is going to be used, the "time" specified for that callback should be maximum for that particular button. So, if say another callback is registered with a time of 11 seconds, the repeat callback defined above will not take effect.</li>
</ol>
<p>A single push button can have multiple such callbacks registered, with a maximum limit of <a class="el" href="push__button_8h.html#ab3f80e0fc754a534b159407dcbf28921">MAX_PB_CB</a>. Consider another example. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;{</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; push_button_set_cb(button_1, button1_cb, 0, 0, NULL);</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160; push_button_set_cb(button_1, button1_5sec_cb, 5000, 0, NULL);</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160; push_button_set_cb(button_1, button1_10sec_cb, 10000, 0, NULL);</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;}</div>
</div><!-- fragment --><ul>
<li>In this case, for a short press, button1_cb will be invoked. button1_cb will be invoked even if the button is pressed for a longer duration but released before 5 seconds.</li>
<li>If the button is pressed for more than 5 seconds but released before 10 seconds, button1_5sec_cb will be invoked.</li>
<li>Since 10 seconds is the maximum time configured for this button, if the button is pressed for 10+ seconds, the button1_10sec_cb will be invoked even if the button is not released.</li>
</ul>
<p>If some pointer is specified as the last argument for push_button_set_cb, it will be received in the pb_cb.</p>
<p>This API takes care of key debouncing (oscillations because of the hardware button press) as well. Hence, the application will not get any false triggers.</p>
<p>If multiple callbacks are registered for the same timeout value, the call registered the latest will be invoked.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">input</td><td>The push button configuration as per <a class="el" href="structinput__gpio__cfg__t.html">input_gpio_cfg_t</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pb_cb</td><td>The push button callback to be invoked for this event. Refer <a class="el" href="mdev__gpio_8h.html#aceff8a2454d2cfeb6b50a77f5048964c">gpio_irq_cb</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">time</td><td>The time in milliseconds for which the button should be pressed to invoke the callback </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">repeat_time</td><td>The time in milliseconds for invoking the callbacks repeatedly as described above. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">data</td><td>A pointer to the data that the applications wants to receive in the callback.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>WM_SUCCESS on success </dd>
<dd>
-WM_FAIL in case of an error </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
